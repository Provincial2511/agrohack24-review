# Что нужно для запуска проекта?
1. Node js
2. Python + poetry

# Как запустить проект?

1. Сначала надо запулить из гитхаба. Потом перейти в корень проекта а потом ввести эти команды
2. В терминале:
3. npm i
4. npm run dev
5. Открыть вторую вкладку терминала
6. cd backend (см. более подробный [README по бекенду](./backend/README.md))
7. `poetry install`
8. `fastapi dev main.py`

# Как попробовать?
Сервис можно протестировать по данному адресу https://somethingintheair.tech/

# Фичи
- выбор произвольной территории для анализа;
- выбор года для анализа;
- есть выбор по-умолчанию территорий в Курской, Воронежской областях и Приамурье;
- можно выбрать только интересующие семплы для анализа;
- погодные условия подгружаются автоматически (Open-Meteo API) на основе введённых данных.

## Демонстрация работы


_Анализ урожайности семплов в указанной территории_


https://github.com/user-attachments/assets/bf3a33a9-f410-4521-8921-ad806c1fb483

_Выбор интересующих семплов в банке семплов_


https://github.com/user-attachments/assets/2d6c620a-502b-48f6-94c1-cd8b105dec7d

# Тренировка модели и подходы

Описание находится в файлах [train.ipynb](./train.ipynb) и [weather.ipynb](./weather.ipynb)


### **AgroHack - soybeans yield prediction**

---

#### **Постановка задачи**
Наша цель — спрогнозировать урожайность сои, используя ее генотипические данные и данные о погодных условиях в регионе высаживания. Для этого мы разработали подход, который позволяет перевести биологические последовательности (нуклеотидный набор, представляющий собой их последовательность с учетом мутаций) в числовые представления, а затем применить машинное обучение для создания предсказательной модели. Этот ноутбук посвящен работе с био фичами и последующим обучением модели вместе с погодой.

---

#### **Методы построения фичей**
Для перевода биологических данных в цифровую форму мы использовали несколько ключевых этапов:

1. **Сбор и обработка генотипических данных**:
   - Данные представлены в формате VCF, содержащем информацию о референсных и альтернативных аллелях для каждой позиции генома.
   - Мы упорядочили данные по хромосоме и позиции, обработали пропуски, чтобы сохранить целостность последовательностей.

2. **Цифровизация последовательностей через `k-mers`**:
   - Длинные нуклеотидные последовательности были разбиты на подстроки фиксированной длины \( k=3 \), так как триплет представляет собой одну аминокислоту.

3. **Эмбеддинги с использованием Word2Vec**:
   - `k-mers` были преобразованы в числовые векторы с использованием модели Word2Vec, которая извлекает контекстные зависимости между ними.
   - Итоговое представление каждой последовательности — это усредненный вектор всех её `k-mers`. Это компактное числовое представление генотипов, готовое для использования в моделях машинного обучения.

---

#### **Baseline**
1. **Работа по его построению**:
   - Каждый генотип представляет собой набор из ~40 тысяч фичей, обработка классическими моделями получилась вычислительно долгой и совершенно неоптимизированной
   - Обработка данных о количестве мутаций для снижения числа фичей и как способ предсказания не дал положительных результатов - 98% дисперсии такая модель обьяснить не может
   - Обработка данных о погоде (соседний ноутбук)
   - Оценка качества на простых моделях (RandomForestRegressor)

---
#### **Методы анализа**
1. **Модели машинного обучения**:
   - Мы использовали CatBoostRegressor для построения модели, которая предсказывает урожайность на основе созданных эмбеддингов и погодных факторов.
   - CatBoost, как градиентный бустинг, показал себя наиболее эффективно благодаря встроенной обработке числовых данных и оптимизации.
   - Также, мы использовали библиотеку optuna для подбора наилучших гиперпараметров модели

2. **Метрики оценки**:
   - Для оценки точности модели мы применили метрики MSE (среднеквадратическая ошибка) и \( R^2 \) (коэффициент детерминации).
   - Эти метрики помогли нам определить, насколько модель отражает реальные данные.

---

#### **Итог**
Мы продемонстрировали, как генетические данные могут быть цифровизированы и использованы для предсказания продуктивности растений. Этот подход:

- Основан на биологических закономерностях, таких как структура `k-mers` в ДНК.
- Применяет современные методы эмбеддингов для создания информативных фичей.
- Использует мощные модели машинного обучения для получения точных прогнозов.
- Качество модели: CatBoost Mean Squared Error (RMSE): **15.2**; CatBoost R^2 Score: **0.163**
- Мы получили решение, с помощью которого в дальнейшем важность отдельных эмбеддингов можно интерпретировать как важность мутации конкретных генов и, отталкиваясь от этого, планировать селекцию и экспериментировать с получившимися генотипами
---
